Esto es una customizacion para TMK


Maxi - Adrian:

 

Les cuento que hay un problema con la interfaz de carga de registraciones......en realidad es una pavadita lo que hay que hacer, pero es diferente a lo que tenemos,....

 

Aqui lo que hacen es lo siguiente...de los archivos de registraciones de los relojes, ellos los capturan, los trabajan un poco (eliminando rgistraciones que no interesan) y luego escriben el resultado en una tabla del RHPRO que en su momento la llamaron TMK_BAJADA_REG. Luego habia una tarea programada, que pasaba de este archivo a la tabla de registraciones.

 

Yo hice el planteo de porque no cargaban directamente en la tabla de registraciones para evitar un paso y la respuesta fue...queremos seguirn con el mismo mecanismo, con lo cual habria que hacer algo para que pase los datos de la tabla TMK_BAJADA_REG a GTI_REGISTRACION.

 

El proceso de hoy dia es el siguiente:

 

 

DEF VAR I AS INTEGER NO-UNDO.
DEF VAR nroter AS INTEGER NO-UNDO.
DEF VAR reloj AS LOG.
DEF VAR j AS INTEGER NO-UNDO.

FOR EACH TMK_BAJADA_REG:
    ASSIGN j = j + 1
           nroter = ?.

  /* IF I = 2 THEN LEAVE. */
    FIND FIRST empleado WHERE empleado.empleg = INTEGER(TMK_BAJADA_REG.legajo) NO-LOCK NO-ERROR.
    IF NOT AVAIL empleado THEN NEXT.
    ASSIGN nroter = empleado.ternro.
    FIND FIRST gti_registracion WHERE gti_registracion.ternro = empleado.ternro AND
                                      gti_registracion.regfecha = TMK_BAJADA_REG.REGFECHA AND
                                      gti_registracion.reghora = REPLACE(TMK_BAJADA_REG.REGHORA,":","") NO-LOCK NO-ERROR.

    IF NOT AVAIL gti_registracion
    THEN DO:
    
    CREATE gti_registracion.
    ASSIGN gti_registracion.regfecha = TMK_BAJADA_REG.REGFECHA
           gti_registracion.reghora = REPLACE(TMK_BAJADA_REG.REGHORA,":","")
           gti_registracion.relnro = 1
           GTI_REGISTRACION.REGENTSAL = ""
           gti_registracion.ternro = empleado.ternro
           gti_registracion.REGMANUAL = FALSE.
    END.
    DELETE tmk_bajada_reg.
    ASSIGN I = I + 1.
END.
PUT UNFORMATTED "Registraciones totales: " + STRING(i) SKIP.

 

 

Saludos, 

 

Ezequiel.




